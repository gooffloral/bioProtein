(()=>{"use strict";function t(){this.data={protein:{1:{key:"1",name:"Гороховый"},2:{key:"2",name:"Подсолнечный"},3:{key:"3",name:"Тыквенный"}},selects:{protein:{selectedtext:"белка(-ов)"}}}}function e(){this.elements={single:{block:{selector:"._options"}},many:{processes:{selector:"._options_item",key:t=>t.dataset.key},tabs:{selector:"._tab",key:t=>t.id}}},this.init(),this.addListeners(),this.loadProcess(this.initEl.processes[1])}function i(t){t.selectedValues={protein:[]},this.dataGlobal=t,this.dataArr=t.data,this.data={protein:t=>{const e=t.name;return`<div class="_params _protein" data-c="protein" data-value=${t.key}>\n                <span class="_title _green ">${e}</span>\n                <button class="_green" data-value="delete">&#10006</button>\n                <br>\n                <input type="text" name="weight" placeholder="Вес (гр)">\n                или \n                <input type="text" name="percentage" placeholder="Процентное содержание (%)">\n                <input type="text" name="isolate" placeholder="Изолят (%)">\n            </div>`}},this.elements={protein:"#protein"},this.init(),this.addListeners()}function s(t){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!1),t.dispatchEvent(e)}function n(t){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),t.dispatchEvent(e)}function o(t){var e=document.createEvent("FocusEvent");e.initEvent("focusin",!0,!1),t.dispatchEvent(e)}function l(t){var e=document.createEvent("FocusEvent");e.initEvent("focusout",!0,!1),t.dispatchEvent(e)}function a(t){var e=document.createEvent("UIEvent");e.initEvent("modalclose",!0,!1),t.dispatchEvent(e)}function r(t,e){"invalid"==e?(h(this.dropdown,"invalid"),p(this.dropdown,"valid")):(h(this.dropdown,"valid"),p(this.dropdown,"invalid"))}function d(t,e){return null!=t[e]?t[e]:t.getAttribute(e)}function c(t,e){return!!t&&t.classList.contains(e)}function h(t,e){if(t)return t.classList.add(e)}function p(t,e){if(t)return t.classList.remove(e)}t.prototype.get=function(t){return this.data[t]},e.prototype.init=function(){this.initEl={};for(const t in this.elements.single)this.initEl[t]=document.querySelector(this.elements.single[t].selector);for(const t in this.elements.many)this.initEl[t]={},document.querySelectorAll(this.elements.many[t].selector).forEach((e=>{const i=this.elements.many[t].key(e);this.initEl[t][i]=e}))},e.prototype.addListeners=function(){for(const t in this.initEl.processes)this.initEl.processes[t].addEventListener("click",(t=>{this.loadProcess(t.target)}))},e.prototype.loadProcess=function(t){const e=t.dataset.key;["processes","tabs"].forEach((t=>{for(const e in this.initEl[t])this.initEl[t][e].classList.remove("--active")})),t.classList.add("--active"),this.initEl.tabs[e].classList.add("--active")},i.prototype.init=function(){this.initEl={};for(const t in this.elements)this.initEl[t]=document.querySelector(this.elements[t])},i.prototype.getData=function(t,e){return this.dataArr[t][e]},i.prototype.getTemplate=function(t,e){return this.data[t](e)},i.prototype.loadData=function(t,e){t.insertAdjacentHTML("afterend",e)},i.prototype.addListeners=function(){this.initEl.protein.addEventListener("change",(t=>{const e=this.initEl.protein.selectedOptions[0].value;if("Выберите белок"!=e){const i=this.getData("protein",this.initEl.protein.selectedOptions[0].value);if(console.log(this.dataGlobal.selectedValues.protein.includes(i.key)),!this.dataGlobal.selectedValues.protein.includes(i.key)){this.dataGlobal.selectedValues.protein.push(e),console.log(this.dataGlobal.selectedValues.protein),this.loadData(this.initEl.protein.parentElement,this.getTemplate("protein",i));const s=`._params._protein[data-value='${i.key}']`,n=new CustomEvent("new-template",{bubbles:!0,detail:{id:"protein",key:i.key,selector:s}});t.target.dispatchEvent(n)}}}))};var u={data:null,searchable:!1,showSelectedItems:!1};function f(t,e){this.el=t,this.config=Object.assign({},u,e||{}),this.data=this.config.data,this.selectedOptions=[],this.placeholder=d(this.el,"placeholder")||this.config.placeholder||"Select an option",this.searchtext=d(this.el,"searchtext")||this.config.searchtext||"Search",this.selectedtext=d(this.el,"selectedtext")||this.config.selectedtext||"selected",this.dropdown=null,this.multiple=d(this.el,"multiple"),this.disabled=d(this.el,"disabled"),this.create()}function v(t){this.dataGlobal=t,this.elements={blocks:{all:'._params[data-value="mass"]',noProtein:'._params[data-value="mass-noprotein"]'}},this.listeners={delete:{e:"click",f:t=>{this.deleteButton(t)}},weight:{e:"keyup",f:t=>{this.weightInput(t)}},percentage:{e:"keyup",f:t=>{this.percentageInput()}},isolate:{e:"keyup",f:t=>{this.isolateInput()}}},this.forTemplate={delete:'button[data-value="delete"]',percentage:'input[name="percentage"]',isolate:'input[name="isolate"]',weight:'input[name="weight"]'},this.template={protein:["delete","percentage","weight"],all:["weight"],noProtein:["weight","percentage"]},document.addEventListener("new-template",(t=>this.newBlock(t))),document.addEventListener("delete-block",(t=>console.log("ggg"))),this.init(),console.log(this.initEl)}function y(){this.init()}f.prototype.create=function(){this.el.style.opacity="0",this.el.style.width="0",this.el.style.padding="0",this.el.style.height="0",this.data?this.processData(this.data):this.extractData(),this.renderDropdown(),this.bindEvent()},f.prototype.processData=function(t){var e=[];t.forEach((t=>{e.push({data:t,attributes:{selected:!!t.selected,disabled:!!t.disabled,optgroup:"optgroup"==t.value}})})),this.options=e},f.prototype.extractData=function(){var t=this.el.querySelectorAll("option,optgroup"),e=[],i=[],s=[];t.forEach((t=>{if("OPTGROUP"==t.tagName)var s={text:t.label,value:"optgroup"};else s={text:t.innerText,value:t.value,selected:null!=t.getAttribute("selected")||this.el.value==t.value,disabled:null!=t.getAttribute("disabled")};var n={selected:t.selected,disabled:t.disabled,optgroup:"OPTGROUP"==t.tagName};e.push(s),i.push({data:s,attributes:n})})),this.data=e,this.options=i,this.options.forEach((t=>{t.attributes.selected&&s.push(t)})),this.selectedOptions=s},f.prototype.renderDropdown=function(){var t=["nice-select",d(this.el,"class")||"",this.disabled?"disabled":"",this.multiple?"has-multiple":""];let e='<div class="nice-select-search-box">';e+=`<input type="text" class="nice-select-search" placeholder="${this.searchtext}..." title="search"/>`,e+="</div>";var i=`<div class="${t.join(" ")}" tabindex="${this.disabled?null:0}">`;i+=`<span class="${this.multiple?"multiple-options":"current"}"></span>`,i+='<div class="nice-select-dropdown">',i+=`${this.config.searchable?e:""}`,i+='<ul class="list"></ul>',i+="</div>",i+="</div>",this.el.insertAdjacentHTML("afterend",i),this.dropdown=this.el.nextElementSibling,this._renderSelectedItems(),this._renderItems()},f.prototype._renderSelectedItems=function(){if(this.multiple){var t="";this.config.showSelectedItems||this.config.showSelectedItems||"auto"==window.getComputedStyle(this.dropdown).width||this.selectedOptions.length<2?(this.selectedOptions.forEach((function(e){t+=`<span class="current">${e.data.text}</span>`})),t=""==t?this.placeholder:t):t=this.selectedOptions.length+" "+this.selectedtext,this.dropdown.querySelector(".multiple-options").innerHTML=t}else{var e=this.selectedOptions.length>0?this.selectedOptions[0].data.text:this.placeholder;this.dropdown.querySelector(".current").innerHTML=e}},f.prototype._renderItems=function(){var t=this.dropdown.querySelector("ul");this.options.forEach((e=>{t.appendChild(this._renderItem(e))}))},f.prototype._renderItem=function(t){var e=document.createElement("li");if(e.innerHTML=t.data.text,t.attributes.optgroup)h(e,"optgroup");else{e.setAttribute("data-value",t.data.value);var i=["option",t.attributes.selected?"selected":null,t.attributes.disabled?"disabled":null];e.addEventListener("click",this._onItemClicked.bind(this,t)),e.classList.add(...i)}return t.element=e,e},f.prototype.update=function(){if(this.extractData(),this.dropdown){var t=c(this.dropdown,"open");this.dropdown.parentNode.removeChild(this.dropdown),this.create(),t&&s(this.dropdown)}d(this.el,"disabled")?this.disable():this.enable()},f.prototype.disable=function(){this.disabled||(this.disabled=!0,h(this.dropdown,"disabled"))},f.prototype.enable=function(){this.disabled&&(this.disabled=!1,p(this.dropdown,"disabled"))},f.prototype.clear=function(){this.resetSelectValue(),this.selectedOptions=[],this._renderSelectedItems(),this.update(),n(this.el)},f.prototype.destroy=function(){this.dropdown&&(this.dropdown.parentNode.removeChild(this.dropdown),this.el.style.display="")},f.prototype.bindEvent=function(){this.dropdown.addEventListener("click",this._onClicked.bind(this)),this.dropdown.addEventListener("keydown",this._onKeyPressed.bind(this)),this.dropdown.addEventListener("focusin",o.bind(this,this.el)),this.dropdown.addEventListener("focusout",l.bind(this,this.el)),this.el.addEventListener("invalid",r.bind(this,this.el,"invalid")),window.addEventListener("click",this._onClickedOutside.bind(this)),this.config.searchable&&this._bindSearchEvent()},f.prototype._bindSearchEvent=function(){var t=this.dropdown.querySelector(".nice-select-search");t&&t.addEventListener("click",(function(t){return t.stopPropagation(),!1})),t.addEventListener("input",this._onSearchChanged.bind(this))},f.prototype._onClicked=function(t){var e,i;if(t.preventDefault(),c(this.dropdown,"open")?this.multiple||(p(this.dropdown,"open"),a(this.el)):(h(this.dropdown,"open"),e=this.el,(i=document.createEvent("UIEvent")).initEvent("modalopen",!0,!1),e.dispatchEvent(i)),c(this.dropdown,"open")){var s=this.dropdown.querySelector(".nice-select-search");s&&(s.value="",s.focus());var n=this.dropdown.querySelector(".focus");p(n,"focus"),h(n=this.dropdown.querySelector(".selected"),"focus"),this.dropdown.querySelectorAll("ul li").forEach((function(t){t.style.display=""}))}else this.dropdown.focus()},f.prototype._onItemClicked=function(t,e){var i=e.target;c(i,"disabled")||(this.multiple?c(i,"selected")?(p(i,"selected"),this.selectedOptions.splice(this.selectedOptions.indexOf(t),1),this.el.querySelector(`option[value="${i.dataset.value}"]`).removeAttribute("selected")):(h(i,"selected"),this.selectedOptions.push(t)):(this.selectedOptions.forEach((function(t){p(t.element,"selected")})),h(i,"selected"),this.selectedOptions=[t]),this._renderSelectedItems(),this.updateSelectValue())},f.prototype.updateSelectValue=function(){if(this.multiple){var t=this.el;this.selectedOptions.forEach((function(e){var i=t.querySelector(`option[value="${e.data.value}"]`);i&&i.setAttribute("selected",!0)}))}else this.selectedOptions.length>0&&(this.el.value=this.selectedOptions[0].data.value);n(this.el)},f.prototype.resetSelectValue=function(){if(this.multiple){var t=this.el;this.selectedOptions.forEach((function(e){var i=t.querySelector(`option[value="${e.data.value}"]`);i&&i.removeAttribute("selected")}))}else this.selectedOptions.length>0&&(this.el.selectedIndex=-1);n(this.el)},f.prototype._onClickedOutside=function(t){this.dropdown.contains(t.target)||(p(this.dropdown,"open"),a(this.el))},f.prototype._onKeyPressed=function(t){var e=this.dropdown.querySelector(".focus"),i=c(this.dropdown,"open");if(13==t.keyCode)s(i?e:this.dropdown);else if(40==t.keyCode){if(i){var n=this._findNext(e);n&&(p(this.dropdown.querySelector(".focus"),"focus"),h(n,"focus"))}else s(this.dropdown);t.preventDefault()}else if(38==t.keyCode){if(i){var o=this._findPrev(e);o&&(p(this.dropdown.querySelector(".focus"),"focus"),h(o,"focus"))}else s(this.dropdown);t.preventDefault()}else if(27==t.keyCode&&i)s(this.dropdown);else if(32===t.keyCode&&i)return!1;return!1},f.prototype._findNext=function(t){for(t=t?t.nextElementSibling:this.dropdown.querySelector(".list .option");t;){if(!c(t,"disabled")&&"none"!=t.style.display)return t;t=t.nextElementSibling}return null},f.prototype._findPrev=function(t){for(t=t?t.previousElementSibling:this.dropdown.querySelector(".list .option:last-child");t;){if(!c(t,"disabled")&&"none"!=t.style.display)return t;t=t.previousElementSibling}return null},f.prototype._onSearchChanged=function(t){var e=c(this.dropdown,"open"),i=t.target.value;if(""==(i=i.toLowerCase()))this.options.forEach((function(t){t.element.style.display=""}));else if(e){var s=new RegExp(i);this.options.forEach((function(t){var e=t.data.text.toLowerCase(),i=s.test(e);t.element.style.display=i?"":"none"}))}this.dropdown.querySelectorAll(".focus").forEach((function(t){p(t,"focus")})),h(this._findNext(null),"focus")},v.prototype.deleteButton=function(t){const e=t.target.parentElement.dataset.value,i=t.target.parentElement.dataset.c,s=this.dataGlobal.selectedValues[i];this.dataGlobal.selectedValues[i]=s.filter((t=>t!=e)),t.target.parentElement.remove()},v.prototype.weightInput=function(t){const e=t.target.parentElement.dataset.c,i=t.target.parentElement.dataset.key;parseInt(t.target.value),console.log(e,i)},v.prototype.percentageInput=function(){},v.prototype.isolateInput=function(){},v.prototype.init=function(){this.initEl={};for(const t in this.elements.blocks){const e=this.elements.blocks[t];this.initEl[t]=this.initElements(e,t),this.addListeners(this.initEl[t])}},v.prototype.addListeners=function(t){for(const e in t){const i=this.listeners[e].e;t[e].addEventListener(i,(t=>{this.listeners[e].f(t)}))}},v.prototype.initElements=function(t,e){const i={};return this.template[e].forEach((e=>{let s=t+" > "+this.forTemplate[e];console.log(s);const n=document.querySelector(s);i[e]=n})),i},v.prototype.newBlock=function(t){const e=t.detail.selector,i=t.detail.id,s=t.detail.key;this.initEl.hasOwnProperty(i)||(this.initEl[i]={}),this.initEl[i][s]=this.initElements(e,i),this.addListeners(this.initEl[i][s])},y.prototype.init=function(){this.data=new t,this.calculator=new v(this.data),this.switcher=new e,this.proteinAdder=new i(this.data,"protein");for(const t in this.data.get("selects"))console.log(t,this.data.get("selects")),new f(document.getElementById(t),this.data.get("selects")[t])},new y})();
//# sourceMappingURL=main.js.map